<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>turbochargers</title>
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/pure-min.css"
          integrity="sha384-nn4HPE8lTHyVtfCBi5yW9d20FjT8BJwUXyWZT9InLYax14RDjBj46LmSztkmNP9w" crossorigin="anonymous">
    <link rel="stylesheet" href="css/style.css" type="text/css">
</head>
<body>
<main>
    <form id="turbosForm" class="pure-form" style="display: block; text-align: center">
        <fieldset>
            <input id="turboText" class="pure-input-rounded pure-input-2-3" placeholder="nowa Turbosprężarka">
            <button id="addTurbo" class="pure-button pure-button-primary">+</button>
        </fieldset>
        <fieldset id="allTurbos" style="display: block"></fieldset>
    </form>
</main>
<script>

    (function () {
        const API_URL = 'http://localhost:8080';
        const TURBO_API_URL = `${API_URL}/turbochargers`;
        const turboText = document.getElementById('turboText');

        fetch(TURBO_API_URL)
            .then(processOkResponse)
            .then(turbos => turbos.forEach(createNewTurbo));

        document.getElementById('addTurbo').addEventListener('click', (event) => {
            event.preventDefault();
            fetch(TURBO_API_URL, {
                method: 'POST',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({description: turboText.value})
            })
                .then(processOkResponse)
                .then(createNewTurbo)
                .then(() => turboText.value = '')
                .catch(console.warn);
        });

        function createNewTurbo(turbocharger) {
            const label = document.createElement('label');
            label.appendChild(document.createTextNode(` ${turbocharger.description}`));
            document.getElementById('allTurbos').appendChild(label);
            document.getElementById("allTurbos").innerHTML += '<br>';
        }

        function processOkResponse(response = {}) {
            if (response.ok) {
                return response.json();
            }
            throw new Error(`Status not 200 (${response.status})`);
        }

    })()
</script>
</body>
</html>